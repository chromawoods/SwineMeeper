/**!
 * @license MIT
 * @author Andreas Weber <andreas@chromawoods.com>
 * @homepage https://github.com/chromawoods/SwineMeeper
*/
modulejs.define("apm",function(){var e={message:"Reveals Per Minute: ",apm:0};e.reset=function(){this.$el.empty(),this.apm=0},e.calculateApm=function(e){return this.apm=(e/(this.timer.getMilliDuration()/1e3/60)).toFixed(1),this},e.update=function(e){this.calculateApm(e).$el.html(this.message+this.apm)};var t=function(t,i){return Object.create(e,{$el:{value:t},timer:{value:i}})};return t}),modulejs.define("cell",["jquery"],function(e){var t={isSwine:!1,isFlagged:!1,isUserClicked:!1,isDetected:!1,isRevealed:!1,adjacentSwine:0,$el:null},i=function(e,i){return Object.create(t,{col:{value:e},row:{value:i},id:{value:"c"+e+"r"+i}})};return t.setElement=function(e){return this.$el=e.data("cellInstance",this),this},t.reveal=function(){return this.isRevealed=!0,this},t.toggleFlagged=function(){return this.isFlagged?(this.isFlagged=!1,this.$el.removeClass("flagged")):(this.isFlagged=!0,this.$el.addClass("flagged")),this},i}),modulejs.define("detector",function(){var e={queue:[]},t=function(t){return Object.create(e,{grid:{value:t}})};return e.setAdjacentSwine=function(e){var t=this.grid.getAdjacentCells(e.col,e.row);e.adjacentSwine=0,t.forEach(function(t){e.adjacentSwine+=t.isSwine?1:0})},e.setAllAdjacentSwine=function(){var e=this;return this.grid.cells.forEach(function(t){e.setAdjacentSwine(t)}.bind(this)),this},e.addToDetectQueue=function(e){var t=!1;if(!e.isDetected&&(e.isDetected=!0,!e.adjacentSwine)){for(var i=0,n=this.queue.length;i<n;i++)if(this.queue[i].id===e.id){t=!0;break}t||this.queue.push(e)}},e.detectArea=function(e,t){e.isDetected=!0,e.adjacentSwine||this.grid.getAdjacentCells(e.col,e.row).forEach(function(e){this.addToDetectQueue(e)}.bind(this)),this.queue.length?this.detectArea(this.queue.pop(),t):"function"==typeof t&&t.apply()},e.detectAll=function(){this.grid.cells.forEach(function(e){e.isDetected=!0})},t}),modulejs.define("grid",["cell","jquery","detector"],function(e,t,i){function n(e,t,n,s){this.$table=e,this.numSwine=s,this.rows=t,this.cols=n,this.cells=[],this.buildGrid(),this.detector=i(this).setAllAdjacentSwine()}return t.extend(n.prototype,{populateSwine:function(e){e=e||this.numSwine;for(var t=function(){var e=Math.floor(Math.random()*this.cells.length),i=this.cells[e];return i.isSwine?t():i}.bind(this),i=0;i<e;i++)t().isSwine=!0},moveSwine:function(e){e.isSwine=!1,e.isUserClicked=!1,this.populateSwine(1),this.detector.setAllAdjacentSwine()},getAdjacentCells:function(e,t){for(var i,n=[],s=0,r=this.cells.length;s<r;s++)i=this.cells[s],i.row<t+2&&i.row>t-2&&i.col<e+2&&i.col>e-2&&(i.col===e&&i.row===t||n.push(this.cells[s]));return n},reset:function(){this.cells.forEach(function(e){e.$el.off().remove()}),this.cells=[]},buildGrid:function(){for(var i=[],n=function(i,n,s){for(var r,l=0;l<i;l++)r=e(l,n).setElement(t("<td/>",{class:"sm-cell",html:'<a class="sm-cell-link" href="#"></a>'})),s.push(r.$el),this.cells.push(r);return s}.bind(this),s=0;s<this.rows;s++)i.push(t("<tr/>",{class:"sm-row"}).append(n(this.cols,s,[])));this.populateSwine(),this.$table.append(i)}}),{getNew:function(e,t,i,s){return new n(e,t,i,s)}}}),modulejs.define("jquery",function(){return jQuery}),modulejs.define("main",["swine-meeper","ui"],function(e,t){return{start:function(){$(".sm-container").each(function(){t(e.getNew($(this)))})}}}),modulejs.define("swine-meeper",["jquery","grid","timer","apm"],function(e,t,i,n){function s(e){this.$el=e,this.$status=this.$el.find("[data-sm-status-message]"),this.timer=i(this.$el.find("[data-sm-timer]")).reset(),this.apm=n(this.$el.find("[data-sm-apm]"),this.timer),this.grid=null,this.addEventHandlers(),this.reset()}return e.extend(s.prototype,{reset:function(){this.isRunning=!1,this.timer.stop(),this.apm.reset(),this.numReveals=0,this.numClicks=0,this.health=0,this.gameOver=!1,this.grid&&this.grid.reset()},start:function(e,i,n){return this.isRunning&&this.reset(),this.updateStatus(""),this.grid=t.getNew(this.$el.removeClass("sm-game-end").find("[data-sm-grid]"),e,i,n),this.timer.reset(),this.isRunning=!0,this},updateStatus:function(e){return this.$status.html(e),this},render:function(){var e=0;this.grid.cells.forEach(function(t){t.isDetected&&!t.isRevealed&&this.onCellRevealed(t.reveal()),t.isRevealed||t.isSwine||(e+=1)}.bind(this)),e||this.gameOver||this.winGame()},doGameOver:function(){return this.$el.addClass("sm-game-end"),this.gameOver=!0,this.apm.update(this.numReveals),this.timer.stop(),this},winGame:function(){this.updateStatus("You win! Yay!").doGameOver()},loseGame:function(){this.updateStatus("Boom! You lost! :("),this.doGameOver().grid.detector.detectAll(),this.render()},loseHealth:function(){this.health-=1,this.health<0&&this.loseGame()},onCellRevealed:function(e){var t="revealed";e.isSwine?(t+=" swine",e.isUserClicked&&this.loseHealth()):e.adjacentSwine?e.$el.children().addClass("adjacent-"+e.adjacentSwine.toString()):t+=" empty",e.$el.addClass(t)},onCellClicked:function(e){var t=e.addClass("is-user-clicked").data("cellInstance");if(t.isFlagged)return!1;if(t.isUserClicked=!0,t.isSwine){if(0===this.numClicks)return this.grid.moveSwine(t),void this.onCellClicked(e);t.isDetected=!0,this.render()}else this.grid.detector.detectArea(t,this.render.bind(this));this.numClicks+=1,this.numReveals+=1},onCellRightClicked:function(e){e.data("cellInstance").toggleFlagged(),this.numClicks+=1},onInteraction:function(){this.numClicks||this.timer.start()},addEventHandlers:function(){var t=this;this.$el.on("click",".sm-cell-link",function(i){t.onInteraction(),t.gameOver||t.onCellClicked(e(this).parent()),i.preventDefault()}),this.$el.on("contextmenu",".sm-cell-link",function(i){t.onInteraction(),t.gameOver||t.onCellRightClicked(e(this).parent()),i.preventDefault()})}}),{getNew:function(e){return new s(e)}}}),modulejs.define("timer",["jquery"],function(e){var t={currentVal:0,currentHumanVal:"",maxVal:999,isRunning:!1,interval:null,intervalDelay:100};t.getMilliDuration=function(){return Date.now()-this.startMillis},t.setHumanValue=function(){var e=this.currentVal,t=e.toString();return this.currentHumanVal=e>=100?t:e>=10?"0"+t:e>0?"00"+t:"000",this.currentVal>0&&t.indexOf(".")<0&&(this.currentHumanVal+=".0"),this},t.init=function(){return this.setHumanValue()},t.render=function(){this.$el.html(this.currentHumanVal)},t.onInterval=function(){var e=1;this.currentVal+=this.intervalDelay/1e3,this.currentVal=Number(Math.round(this.currentVal+"e"+e)+"e-"+e),this.setHumanValue().render()},t.start=function(){this.startMillis=Date.now(),this.isRunning=!0,this.interval=setInterval(this.onInterval.bind(this),this.intervalDelay)},t.stop=function(){return clearInterval(this.interval),this.isRunning=!1,this},t.reset=function(){return this.currentVal=0,this.setHumanValue(),this.isRunning=!1,clearInterval(this.interval),this.render(),this};var i=function(e){var i=Object.create(t,{$el:{value:e}});return i.init()};return i}),modulejs.define("ui",["jquery"],function(e){var t={DIFFICULTIES:{easy:{rows:9,cols:9,numSwine:10},normal:{rows:16,cols:16,numSwine:40},hard:{rows:24,cols:24,numSwine:99}}},i=function(e){var i=Object.create(t,{sm:{value:e},$el:{value:e.$el},$difficulty:{value:e.$el.find("[data-sm-difficulty]")}});return i.init(),i};return t.onChangeDifficulty=function(){var e=this.$difficulty.val();this.DIFFICULTIES.hasOwnProperty(e)&&this.sm.start(this.DIFFICULTIES[e].rows,this.DIFFICULTIES[e].cols,this.DIFFICULTIES[e].numSwine)},t.init=function(){this.addEventHandlers(),this.onChangeDifficulty()},t.addEventHandlers=function(){this.$difficulty.on("change",this.onChangeDifficulty.bind(this)),this.$el.on("click","[data-sm-reset]",function(){this.onChangeDifficulty()}.bind(this))},i});